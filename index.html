<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#000">
<link rel="manifest" href="manifest.json">
<title>Gym Tracker</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro',sans-serif;background:#000;color:#fff;
  padding:env(safe-area-inset-top) 16px env(safe-area-inset-bottom);min-height:100dvh;
  -webkit-text-size-adjust:100%;overscroll-behavior-x:none}

/* Pull to refresh */
.ptr{text-align:center;color:#636366;font-size:13px;padding:0;height:0;overflow:hidden;
  transition:height .2s,opacity .2s;opacity:0}
.ptr.visible{height:40px;opacity:1;padding:10px 0}
.ptr.refreshing{color:#30d158}

/* Views */
.view{display:none}.view.active{display:block}

/* Header */
.header{padding:16px 0 12px;display:flex;align-items:center;gap:12px}
.header h1{font-size:22px;font-weight:700;flex:1}
.back-btn{font-size:28px;color:#0a84ff;background:none;border:none;cursor:pointer;padding:4px 8px 4px 0}
.header-action{font-size:14px;color:#0a84ff;background:none;border:none;cursor:pointer;font-weight:600;padding:8px}

/* Home */
.home-card{background:#1c1c1e;border-radius:16px;padding:20px;margin-bottom:12px;cursor:pointer;
  display:flex;align-items:center;gap:16px;transition:transform .1s}
.home-card:active{transform:scale(0.97)}
.home-card .icon{font-size:36px;width:56px;height:56px;border-radius:14px;display:flex;
  align-items:center;justify-content:center;flex-shrink:0}
.home-card .icon.a{background:#1a3a1a}
.home-card .icon.b{background:#1a2a3a}
.home-card .icon.hist{background:#2a2a1a}
.home-card h2{font-size:17px;font-weight:600}
.home-card p{font-size:13px;color:#8e8e93;margin-top:2px}
.home-card .arrow{color:#3a3a3c;font-size:20px;margin-left:auto}

/* Stats bar */
.stats-bar{background:#1c1c1e;border-radius:12px;padding:14px 16px;margin-bottom:16px;
  display:flex;justify-content:space-around;text-align:center}
.stats-bar .stat-val{font-size:20px;font-weight:700}
.stats-bar .stat-label{font-size:11px;color:#8e8e93;margin-top:2px}

/* Workout */
.superset{background:#1c1c1e;border-radius:14px;margin-bottom:12px;overflow:hidden}
.superset-header{padding:10px 16px;font-size:12px;font-weight:700;letter-spacing:.5px;
  text-transform:uppercase;display:flex;align-items:center;gap:8px}
.superset-header .badge{background:#2c2c2e;border-radius:6px;padding:2px 8px;font-size:11px;
  color:#aeaeb2;font-weight:500;margin-left:auto}
.superset.green .superset-header{background:#0d3d1a;color:#30d158}
.superset.blue .superset-header{background:#0d2540;color:#0a84ff}
.superset.purple .superset-header{background:#2d1a3d;color:#bf5af2}
.superset.orange .superset-header{background:#3d2a0d;color:#ff9f0a}
.superset.red .superset-header{background:#3d1a1a;color:#ff453a}

.exercise{padding:12px 16px;border-bottom:1px solid #2c2c2e}
.exercise:last-child{border-bottom:none}
.ex-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.ex-name-row{display:flex;align-items:center;gap:6px}
.ex-name{font-size:15px;font-weight:600}
.ex-detail{font-size:12px;color:#8e8e93}
.ex-target{font-size:13px;color:#0a84ff;font-weight:600;flex-shrink:0}

/* Multi-set rows */
.set-row{display:flex;gap:6px;align-items:center;margin-bottom:4px}
.set-row:last-child{margin-bottom:0}
.set-label{font-size:11px;color:#636366;width:20px;text-align:center;font-weight:600;flex-shrink:0}
.ex-input{width:56px;height:38px;background:#2c2c2e;border:2px solid #3a3a3c;border-radius:10px;
  color:#fff;font-size:16px;font-weight:600;text-align:center;-webkit-appearance:none;appearance:none}
.ex-input:focus{border-color:#0a84ff;outline:none}
.ex-input::placeholder{color:#636366;font-weight:400}
.ex-unit{font-size:11px;color:#636366;width:20px}
.ex-x{font-size:13px;color:#636366}

/* Info button */
.info-btn{background:none;border:none;color:#636366;font-size:16px;cursor:pointer;padding:2px 4px;
  line-height:1;border-radius:50%;flex-shrink:0}
.info-btn:active{color:#0a84ff}

/* Exercise info modal */
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.6);z-index:200;
  display:none;align-items:flex-end;justify-content:center;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}
.modal-overlay.open{display:flex}
.modal-sheet{background:#1c1c1e;border-radius:20px 20px 0 0;width:100%;max-width:500px;
  max-height:70vh;overflow-y:auto;padding:20px 20px env(safe-area-inset-bottom);
  animation:slideUp .25s ease-out}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal-handle{width:36px;height:5px;background:#3a3a3c;border-radius:3px;margin:0 auto 16px;
  padding:10px 40px;background-clip:content-box;cursor:pointer}
.modal-title{font-size:19px;font-weight:700;margin-bottom:4px}
.modal-muscles{font-size:13px;color:#8e8e93;margin-bottom:16px}
.modal-section{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
.modal-section.do{color:#30d158}
.modal-section.dont{color:#ff453a}
.do-list,.dont-list{list-style:none;margin-bottom:16px}
.do-list li,.dont-list li{font-size:14px;padding:6px 0;padding-left:20px;position:relative;line-height:1.4}
.do-list li::before{content:'‚úì';position:absolute;left:0;color:#30d158;font-weight:700}
.dont-list li::before{content:'‚úó';position:absolute;left:0;color:#ff453a;font-weight:700}
.modal-close{width:100%;padding:14px;border-radius:12px;font-size:16px;font-weight:600;
  background:#2c2c2e;color:#fff;border:none;cursor:pointer;margin-top:4px}

/* Feedback textarea */
.feedback-area{width:100%;background:#1c1c1e;border:2px solid #3a3a3c;border-radius:14px;
  color:#fff;font-size:14px;font-family:inherit;padding:12px 16px;resize:vertical;min-height:80px;
  margin-bottom:12px;-webkit-appearance:none;appearance:none}
.feedback-area:focus{border-color:#0a84ff;outline:none}
.feedback-area::placeholder{color:#636366}

/* Feedback display in detail */
.detail-feedback{background:#1c1c1e;border-radius:12px;padding:14px 16px;margin-bottom:8px;
  border-left:3px solid #ff9f0a}
.detail-feedback-label{font-size:12px;color:#ff9f0a;font-weight:600;text-transform:uppercase;
  letter-spacing:.5px;margin-bottom:4px}
.detail-feedback-text{font-size:14px;color:#aeaeb2;line-height:1.5}

/* Rest indicator */
.rest-tag{font-size:11px;color:#636366;text-align:center;padding:4px 0}

/* Bottom actions */
.bottom-bar{position:sticky;bottom:0;padding:12px 0 20px;background:linear-gradient(transparent,#000 20%)}
.btn{width:100%;padding:16px;border-radius:14px;font-size:17px;font-weight:600;border:none;
  cursor:pointer;transition:transform .1s}
.btn:active{transform:scale(0.97)}
.btn-green{background:#30d158;color:#000}
.btn-blue{background:#0a84ff;color:#fff}
.btn-outline{background:transparent;border:2px solid #3a3a3c;color:#fff}
.btn+.btn{margin-top:8px}

/* History */
.hist-item{background:#1c1c1e;border-radius:12px;padding:14px 16px;margin-bottom:8px;
  display:flex;align-items:center;cursor:pointer;transition:transform .1s}
.hist-item:active{transform:scale(0.97)}
.hist-date{font-size:15px;font-weight:600;flex:1}
.hist-schema{font-size:13px;color:#8e8e93;margin-left:8px}
.hist-arrow{color:#3a3a3c;font-size:16px;margin-left:8px}
.empty-state{text-align:center;padding:60px 20px;color:#636366}
.empty-state .emoji{font-size:48px;margin-bottom:12px}
.empty-state p{font-size:15px}

/* Detail */
.detail-exercise{background:#1c1c1e;border-radius:12px;padding:14px 16px;margin-bottom:8px}
.detail-name{font-size:15px;font-weight:600;margin-bottom:6px}
.detail-sets-table{width:100%}
.detail-set-row{display:flex;gap:8px;align-items:center;padding:2px 0}
.detail-set-label{font-size:11px;color:#636366;width:22px;font-weight:600}
.detail-set-val{font-size:14px}
.detail-set-val span{color:#8e8e93}
.detail-vals{display:flex;gap:16px}
.detail-val{font-size:14px}
.detail-val span{color:#8e8e93}

/* Share */
.share-preview{background:#1c1c1e;border-radius:12px;padding:16px;margin:12px 0;
  font-family:monospace;font-size:13px;color:#aeaeb2;white-space:pre-wrap;line-height:1.6}

/* Timer toast */
.toast{position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:#2c2c2e;
  color:#fff;padding:10px 20px;border-radius:12px;font-size:14px;font-weight:600;
  opacity:0;transition:opacity .3s;pointer-events:none;z-index:100}
.toast.show{opacity:1}
</style>
</head>
<body>

<!-- HOME VIEW -->
<div id="home" class="view active">
  <div class="ptr" id="ptr">‚Üì Pull to refresh</div>
  <div class="header">
    <h1>Gym Tracker</h1>
    <button class="header-action" onclick="doRefresh()">‚Üª</button>
  </div>

  <div class="stats-bar" id="statsBar">
    <div><div class="stat-val" id="statWorkouts">0</div><div class="stat-label">workouts</div></div>
    <div><div class="stat-val" id="statStreak">0</div><div class="stat-label">deze week</div></div>
    <div><div class="stat-val" id="statLast">‚Äî</div><div class="stat-label">laatste</div></div>
  </div>

  <div class="home-card" onclick="startWorkout('A')">
    <div class="icon a">üí™</div>
    <div><h2>Schema A ‚Äî Maandag</h2><p>Strength Focus ‚Ä¢ 30 sets ‚Ä¢ ~90 min</p></div>
    <div class="arrow">‚Ä∫</div>
  </div>

  <div class="home-card" onclick="startWorkout('B')">
    <div class="icon b">üî•</div>
    <div><h2>Schema B ‚Äî Donderdag</h2><p>Volume Focus ‚Ä¢ 30 sets ‚Ä¢ ~90 min</p></div>
    <div class="arrow">‚Ä∫</div>
  </div>

  <div class="home-card" onclick="showView('history')">
    <div class="icon hist">üìä</div>
    <div><h2>Geschiedenis</h2><p>Bekijk en deel eerdere workouts</p></div>
    <div class="arrow">‚Ä∫</div>
  </div>
</div>

<!-- WORKOUT VIEW -->
<div id="workout" class="view">
  <div class="header">
    <button class="back-btn" onclick="confirmExit()">‚Äπ</button>
    <h1 id="workoutTitle"></h1>
  </div>
  <div id="workoutExercises"></div>
  <textarea id="workoutFeedback" class="feedback-area" rows="3"
    placeholder="Opmerkingen (optioneel) ‚Äî bijv. schouder voelde strak, squat diepte was beter..."></textarea>
  <div class="bottom-bar">
    <button class="btn btn-green" onclick="saveWorkout()">Workout opslaan</button>
  </div>
</div>

<!-- HISTORY VIEW -->
<div id="history" class="view">
  <div class="header">
    <button class="back-btn" onclick="showView('home')">‚Äπ</button>
    <h1>Geschiedenis</h1>
  </div>
  <div id="historyList"></div>
</div>

<!-- DETAIL VIEW -->
<div id="detail" class="view">
  <div class="header">
    <button class="back-btn" onclick="showView('history')">‚Äπ</button>
    <h1 id="detailTitle"></h1>
    <button class="header-action" onclick="shareWorkout()">Deel</button>
  </div>
  <div id="detailContent"></div>
  <div style="padding:20px 0">
    <button class="btn btn-outline" style="color:#ff453a;border-color:#ff453a" onclick="deleteWorkout()">Verwijder workout</button>
  </div>
</div>

<!-- SHARE VIEW -->
<div id="share" class="view">
  <div class="header">
    <button class="back-btn" onclick="showView('detail')">‚Äπ</button>
    <h1>Deel resultaten</h1>
  </div>
  <p style="color:#8e8e93;font-size:14px;margin-bottom:8px">Kopieer en plak in de Claude chat:</p>
  <div class="share-preview" id="sharePreview"></div>
  <button class="btn btn-blue" onclick="copyToClipboard()">Kopieer naar klembord</button>
</div>

<!-- EXERCISE INFO MODAL -->
<div class="modal-overlay" id="exerciseModal" onclick="closeExerciseInfo(event)">
  <div class="modal-sheet" onclick="event.stopPropagation()">
    <div class="modal-handle" onclick="closeExerciseInfo()"></div>
    <div class="modal-title" id="modalTitle"></div>
    <div class="modal-muscles" id="modalMuscles"></div>
    <div class="modal-section do">DO's</div>
    <ul class="do-list" id="modalDos"></ul>
    <div class="modal-section dont">DON'Ts</div>
    <ul class="dont-list" id="modalDonts"></ul>
    <button class="modal-close" onclick="closeExerciseInfo()">Sluiten</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// === EXERCISE INFO ===
const EXERCISE_INFO = {
  'Barbell Squat': {
    muscles: 'Quadriceps, glutes, core',
    dos: ['Voeten schouderbreedte, tenen licht naar buiten', 'Daal tot minstens 90¬∞ kniehoek', 'Borst omhoog, rug neutraal houden'],
    donts: ['Knie√´n niet naar binnen laten vallen', 'Niet op je tenen leunen', 'Geen bouncing onderaan']
  },
  'Pull-ups': {
    muscles: 'Lats, biceps, bovenarmen',
    dos: ['Volledige ROM: hang tot kin boven stang', 'Schouderbladen naar beneden trekken bij start', 'Gecontroleerd laten zakken (negatief)'],
    donts: ['Niet kip-achtig swingen/kippen', 'Niet halverwege stoppen', 'Geen overmatig momentum gebruiken']
  },
  'Flat Bench Press': {
    muscles: 'Borst, triceps, voorste schouder',
    dos: ['Schouderbladen samenknijpen en naar beneden', 'Stang naar midden borst laten zakken', 'Voeten plat op de grond voor stabiliteit'],
    donts: ['Billen niet van de bank tillen', 'Stang niet laten bouncen op je borst', 'Polsen niet laten knikken (recht houden)']
  },
  'Seated Cable Row': {
    muscles: 'Middenrug, lats, biceps',
    dos: ['Borst vooruit, rug recht houden', 'Ellebogen langs het lichaam trekken', 'Schouderbladen samenknijpen aan het eind'],
    donts: ['Niet te ver achterover leunen', 'Niet met je onderrug trekken', 'Schouders niet optrekken']
  },
  'Romanian Deadlift': {
    muscles: 'Hamstrings, glutes, onderrug',
    dos: ['Heupscharnier: kont naar achteren duwen', 'Stang dicht langs je benen houden', 'Lichte kniebuiging, niet doorbuigen'],
    donts: ['Rug niet laten afronden', 'Niet te diep gaan (halverwege scheenbeen is genoeg)', 'Niet met de armen trekken']
  },
  'DB Shoulder Press': {
    muscles: 'Schouders (deltoids), triceps',
    dos: ['Ellebogen op 45¬∞ naast het lichaam', 'Dumbbells tot net boven schouderhoogte laten zakken', 'Core aanspannen, geen holle rug'],
    donts: ['Niet achterover leunen voor extra kracht', 'Gewicht niet te snel laten zakken', 'Ellebogen niet achter de schouders brengen']
  },
  'Cable Crunch': {
    muscles: 'Rectus abdominis (sixpack)',
    dos: ['Heupen gefixeerd houden, alleen buigen vanuit de buik', 'Langzaam en gecontroleerd bewegen', 'Uitademen bij het crunchen'],
    donts: ['Niet met je armen/heupen trekken', 'Niet te snel of ongecontroleerd bewegen', 'Nek niet forceren']
  },
  'Leg Raise': {
    muscles: 'Onderbuik, hip flexors',
    dos: ['Benen gestrekt of licht gebogen omhoog brengen', 'Bekken kantelen aan de top voor maximale activatie', 'Langzaam laten zakken (controle)'],
    donts: ['Niet swingen voor momentum', 'Onderrug niet van het pad laten komen', 'Niet halverwege stoppen']
  },
  'Preacher Curl': {
    muscles: 'Biceps (korte kop), brachialis',
    dos: ['Bovenarmen volledig op het pad laten rusten', 'Gecontroleerde beweging omhoog en omlaag', 'Volledige ROM: bijna gestrekt tot volledig gebogen'],
    donts: ['Niet achterover leunen om te helpen', 'Ellebogen niet van het pad tillen', 'Geen swingbeweging gebruiken']
  },
  'Tricep Dips': {
    muscles: 'Triceps, borst, voorste schouder',
    dos: ['Bovenlichaam licht voorover voor borst-accent, recht voor triceps', 'Daal tot 90¬∞ ellebooghoek', 'Schouders naar beneden houden'],
    donts: ['Niet te diep zakken (schouder stress)', 'Niet met je benen trappen voor momentum', 'Schouders niet naar je oren trekken']
  },
  'V-Squat': {
    muscles: 'Quadriceps, glutes',
    dos: ['Voeten op schouderbreedte, hoog op het platform voor meer glutes', 'Volle ROM tot minstens 90¬∞ kniehoek', 'Rug plat tegen het pad houden'],
    donts: ['Knie√´n niet naar binnen laten vallen', 'Niet met halve reps werken', 'Niet op je tenen duwen']
  },
  'Lat Pulldown': {
    muscles: 'Lats, biceps, middenrug',
    dos: ['Trek de stang naar je bovenborst', 'Schouderbladen naar beneden en samen trekken', 'Licht achterover leunen (15-20¬∞)'],
    donts: ['Niet te ver achterover leunen', 'Niet met momentum trekken', 'Stang niet achter je hoofd trekken']
  },
  'DB Incline Press': {
    muscles: 'Bovenborst, schouders, triceps',
    dos: ['Bank op 30-45¬∞ incline', 'Dumbbells op schouderlijn laten zakken', 'Schouderbladen samenknijpen tegen de bank'],
    donts: ['Niet te steil instellen (>45¬∞ = teveel schouder)', 'Ellebogen niet te wijd (90¬∞+) openen', 'Gewicht niet laten bouncen']
  },
  'Leg Curl': {
    muscles: 'Hamstrings',
    dos: ['Heupen plat op de bank houden', 'Volle ROM: bijna gestrekt tot volledig gebogen', 'Langzaam terugbrengen (excentrisch)'],
    donts: ['Heupen niet van de bank tillen', 'Niet met je onderrug compenseren', 'Niet te snel bewegen']
  },
  'DB Lateral Raise': {
    muscles: 'Zijschouder (mediale deltoid)',
    dos: ['Lichte vooroverbuiging, ellebogen iets gebogen', 'Til tot schouderhoogte, niet hoger', 'Pinken iets omhoog draaien (gietbeweging)'],
    donts: ['Niet swingen of momentum gebruiken', 'Traps niet overnemen (schouders laag houden)', 'Niet te zwaar gaan ten koste van techniek']
  },
  'Plate-loaded Row': {
    muscles: 'Lats, middenrug, biceps',
    dos: ['Borst tegen het pad drukken', 'Trek naar je navel/onderborst', 'Schouderbladen samenknijpen bovenin'],
    donts: ['Niet achterover leunen van het pad af', 'Niet met je onderrug trekken', 'Schouders niet optrekken naar je oren']
  },
  'Ab Machine': {
    muscles: 'Rectus abdominis (sixpack)',
    dos: ['Buik aanspannen v√≥√≥r de beweging', 'Langzaam en gecontroleerd crunchen', 'Focus op buikspieren, niet op armen'],
    donts: ['Niet met je armen/handen duwen', 'Niet met momentum werken', 'Nek niet forceren of vooruit duwen']
  },
  'Pallof Press': {
    muscles: 'Core (anti-rotatie), obliques',
    dos: ['Sta op schouderbreedte, knie√´n licht gebogen', 'Duw handen recht naar voren vanuit je borst', 'Houd je heupen en schouders recht naar voren'],
    donts: ['Niet laten draaien door de kabel', 'Niet te snel bewegen', 'Heupen niet laten meedraaien']
  },
  'DB Hammer Curl': {
    muscles: 'Biceps, brachialis, brachioradialis',
    dos: ['Houd dumbbells in neutrale grip (duimen omhoog)', 'Bovenarmen langs je lichaam gefixeerd', 'Volledige ROM: gestrekt tot volledig gebogen'],
    donts: ['Niet met je hele lichaam swingen', 'Ellebogen niet naar voren brengen', 'Niet afwisselend (doe beide tegelijk voor focus)']
  },
  'OH Tricep Extension': {
    muscles: 'Triceps (lange kop)',
    dos: ['Ellebogen naast je hoofd, wijzend naar voren', 'Volledige strekking bovenin voor piek-contractie', 'Gecontroleerd laten zakken achter je hoofd'],
    donts: ['Ellebogen niet naar buiten laten wijken', 'Niet met je rug compenseren', 'Niet te snel of ongecontroleerd bewegen']
  }
};

// === SCHEMA DEFINITIONS ===
const SCHEMAS = {
  A: {
    name: 'Schema A ‚Äî Maandag',
    subtitle: 'Strength Focus',
    supersets: [
      {
        name: 'A: Squat + Pull-ups', sets: 4, rest: '2 min', color: 'green',
        warmup: '1x10 @bar, 1x8 @50kg, 1x5 @70kg',
        exercises: [
          { id: 'a1', name: 'Barbell Squat', detail: '6-8 reps ‚Ä¢ volle diepte', target_kg: 90,
            target_sets: [{kg:90,reps:6},{kg:90,reps:6},{kg:90,reps:6},{kg:90,reps:6}] },
          { id: 'a2', name: 'Pull-ups', detail: '6-8 reps', target_kg: 0, target_label: 'BW',
            target_sets: [{kg:0,reps:6},{kg:0,reps:6},{kg:0,reps:6},{kg:0,reps:6}] }
        ]
      },
      {
        name: 'B: Bench Press + Row', sets: 3, rest: '90s', color: 'blue',
        warmup: '1x8 bench @40kg',
        exercises: [
          { id: 'b1', name: 'Flat Bench Press', detail: '8-10 reps', target_kg: 65,
            target_sets: [{kg:65,reps:10},{kg:65,reps:10},{kg:65,reps:10}] },
          { id: 'b2', name: 'Seated Cable Row', detail: '8-10 reps', target_kg: 65,
            target_sets: [{kg:65,reps:8},{kg:65,reps:8},{kg:65,reps:8}] }
        ]
      },
      {
        name: 'C: RDL + Shoulder Press', sets: 3, rest: '75s', color: 'purple',
        exercises: [
          { id: 'c1', name: 'Romanian Deadlift', detail: '10-12 reps ‚Ä¢ straps ok', target_kg: 90,
            target_sets: [{kg:90,reps:10},{kg:90,reps:10},{kg:90,reps:10}] },
          { id: 'c2', name: 'DB Shoulder Press', detail: '10-12 reps ‚Ä¢ bank ~80¬∞', target_kg: 22.5, target_label: '2x22.5 kg',
            target_sets: [{kg:22.5,reps:10},{kg:22.5,reps:10},{kg:22.5,reps:10}] }
        ]
      },
      {
        name: 'D: Core', sets: 3, rest: '45s', color: 'orange',
        exercises: [
          { id: 'd1', name: 'Leg Raise', detail: '10-15 reps ‚Ä¢ captain\'s chair', target_kg: 0, target_label: 'BW',
            target_sets: [{kg:0,reps:15},{kg:0,reps:15},{kg:0,reps:15}] },
          { id: 'd2', name: 'Cable Crunch', detail: '12-15 reps ‚Ä¢ 2 katrollen', target_kg: 70,
            target_sets: [{kg:70,reps:12},{kg:70,reps:12},{kg:70,reps:12}] }
        ]
      },
      {
        name: 'E: Arms', sets: 2, rest: '45s', color: 'red',
        exercises: [
          { id: 'e1', name: 'Preacher Curl', detail: '10-12 reps ‚Ä¢ EZ-bar + gewicht', target_kg: 20, target_label: 'EZ+20 kg',
            target_sets: [{kg:20,reps:10},{kg:20,reps:10}] },
          { id: 'e2', name: 'Tricep Dips', detail: '8-12 reps', target_kg: 5, target_label: 'BW+5 kg',
            target_sets: [{kg:5,reps:8},{kg:5,reps:8}] }
        ]
      }
    ]
  },
  B: {
    name: 'Schema B ‚Äî Donderdag',
    subtitle: 'Volume Focus',
    supersets: [
      {
        name: 'A: V-Squat + Pulldown', sets: 4, rest: '90s', color: 'green',
        warmup: '1x10 V-Squat @60kg, 1x10 Pulldown @35kg',
        exercises: [
          { id: 'a1', name: 'V-Squat', detail: '10-12 reps', target_kg: 115,
            target_sets: [{kg:115,reps:10},{kg:115,reps:10},{kg:115,reps:10},{kg:115,reps:10}] },
          { id: 'a2', name: 'Lat Pulldown', detail: '10-12 reps ‚Ä¢ close grip', target_kg: 60,
            target_sets: [{kg:60,reps:10},{kg:60,reps:10},{kg:60,reps:10},{kg:60,reps:10}] }
        ]
      },
      {
        name: 'B: Incline + Leg Curl', sets: 3, rest: '90s', color: 'blue',
        exercises: [
          { id: 'b1', name: 'DB Incline Press', detail: '10-12 reps', target_kg: 24, target_label: '2x24 kg',
            target_sets: [{kg:24,reps:10},{kg:24,reps:10},{kg:24,reps:10}] },
          { id: 'b2', name: 'Leg Curl', detail: '12-15 reps', target_kg: 45,
            target_sets: [{kg:45,reps:12},{kg:45,reps:12},{kg:45,reps:12}] }
        ]
      },
      {
        name: 'C: Lateral + Row', sets: 3, rest: '75s', color: 'purple',
        exercises: [
          { id: 'c1', name: 'DB Lateral Raise', detail: '12-15 reps', target_kg: 10, target_label: '2x10 kg',
            target_sets: [{kg:10,reps:12},{kg:10,reps:12},{kg:10,reps:12}] },
          { id: 'c2', name: 'Plate-loaded Row', detail: '10-12 reps ‚Ä¢ Panatta', target_kg: 35, target_label: '35 kg/kant',
            target_sets: [{kg:35,reps:10},{kg:35,reps:10},{kg:35,reps:10}] }
        ]
      },
      {
        name: 'D: Core', sets: 3, rest: '45s', color: 'orange',
        exercises: [
          { id: 'd1', name: 'Ab Machine', detail: '12-15 reps', target_kg: 75,
            target_sets: [{kg:75,reps:12},{kg:75,reps:12},{kg:75,reps:12}] },
          { id: 'd2', name: 'Pallof Press', detail: '10 reps per kant', target_kg: 25,
            target_sets: [{kg:25,reps:10},{kg:25,reps:10},{kg:25,reps:10}] }
        ]
      },
      {
        name: 'E: Arms', sets: 2, rest: '45s', color: 'red',
        exercises: [
          { id: 'e1', name: 'DB Hammer Curl', detail: '10-12 reps', target_kg: 14, target_label: '2x14 kg',
            target_sets: [{kg:14,reps:10},{kg:14,reps:10}] },
          { id: 'e2', name: 'OH Tricep Extension', detail: '10-12 reps ‚Ä¢ kabel', target_kg: 35,
            target_sets: [{kg:35,reps:10},{kg:35,reps:10}] }
        ]
      }
    ]
  }
};

// === STATE ===
let currentSchema = null;
let currentWorkout = {};
let viewingWorkout = null;
let viewingIndex = -1;

// === STORAGE ===
function getWorkouts() {
  return JSON.parse(localStorage.getItem('gym_workouts') || '[]');
}
function saveWorkouts(w) {
  localStorage.setItem('gym_workouts', JSON.stringify(w));
}

// === NAVIGATION ===
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0, 0);
  if (id === 'home') updateStats();
  if (id === 'history') renderHistory();
}

// === HOME STATS ===
function updateStats() {
  const workouts = getWorkouts();
  document.getElementById('statWorkouts').textContent = workouts.length;

  const now = new Date();
  const weekStart = new Date(now);
  weekStart.setDate(now.getDate() - now.getDay() + 1);
  weekStart.setHours(0,0,0,0);
  const thisWeek = workouts.filter(w => new Date(w.date) >= weekStart).length;
  document.getElementById('statStreak').textContent = thisWeek;

  if (workouts.length > 0) {
    const last = new Date(workouts[0].date);
    const days = Math.floor((now - last) / 86400000);
    document.getElementById('statLast').textContent = days === 0 ? 'vandaag' : days === 1 ? 'gisteren' : days + 'd';
  }
}

// === EXERCISE INFO MODAL ===
function showExerciseInfo(name) {
  const info = EXERCISE_INFO[name];
  if (!info) return;
  document.getElementById('modalTitle').textContent = name;
  document.getElementById('modalMuscles').textContent = info.muscles;
  document.getElementById('modalDos').innerHTML = info.dos.map(d => `<li>${d}</li>`).join('');
  document.getElementById('modalDonts').innerHTML = info.donts.map(d => `<li>${d}</li>`).join('');
  document.getElementById('exerciseModal').classList.add('open');
}

function closeExerciseInfo(e) {
  if (e && e.target !== e.currentTarget) return;
  document.getElementById('exerciseModal').classList.remove('open');
}

// === WORKOUT ===
function startWorkout(schema) {
  currentSchema = schema;
  currentWorkout = {};
  const s = SCHEMAS[schema];

  document.getElementById('workoutTitle').textContent = s.name;
  document.getElementById('workoutFeedback').value = '';

  let html = '';
  s.supersets.forEach(ss => {
    html += `<div class="superset ${ss.color}">`;
    html += `<div class="superset-header">${ss.name}<span class="badge">${ss.sets} sets ‚Ä¢ ${ss.rest} rust</span></div>`;
    if (ss.warmup) {
      html += `<div style="padding:6px 16px;font-size:12px;color:#8e8e93;font-style:italic">Warmup: ${ss.warmup}</div>`;
    }
    ss.exercises.forEach(ex => {
      const targetStr = ex.target_label || (ex.target_kg > 0 ? ex.target_kg + ' kg' : 'BW');
      const hasInfo = EXERCISE_INFO[ex.name];

      html += `<div class="exercise">
        <div class="ex-top">
          <div>
            <div class="ex-name-row">
              <div class="ex-name">${ex.name}</div>
              ${hasInfo ? `<button class="info-btn" onclick="showExerciseInfo('${ex.name.replace(/'/g, "\\'")}')">‚ìò</button>` : ''}
            </div>
            <div class="ex-detail">${ex.detail}</div>
          </div>
          <div class="ex-target">Doel: ${targetStr}</div>
        </div>`;

      // Render N set rows ‚Äî pre-fill with target_sets
      for (let si = 0; si < ss.sets; si++) {
        const tgt = ex.target_sets?.[si] || {};
        const fillKg = tgt.kg !== undefined ? tgt.kg : '';
        const fillReps = tgt.reps !== undefined ? tgt.reps : '';
        html += `<div class="set-row">
          <div class="set-label">S${si + 1}</div>
          <input class="ex-input" type="number" inputmode="decimal" id="kg_${ex.id}_${si}"
            placeholder="${ex.target_kg || '‚Äî'}" value="${fillKg}"
            oninput="autoSave('${ex.id}',${ss.sets})">
          <div class="ex-unit">kg</div>
          <div class="ex-x">√ó</div>
          <input class="ex-input" type="number" inputmode="numeric" id="reps_${ex.id}_${si}"
            placeholder="‚Äî" value="${fillReps}"
            oninput="autoSave('${ex.id}',${ss.sets})">
          <div class="ex-unit">reps</div>
        </div>`;
      }

      html += '</div>';
    });
    html += '</div>';
  });

  document.getElementById('workoutExercises').innerHTML = html;
  showView('workout');
}

function autoSave(id, numSets) {
  const sets = [];
  for (let i = 0; i < numSets; i++) {
    const kg = document.getElementById('kg_' + id + '_' + i)?.value || '';
    const reps = document.getElementById('reps_' + id + '_' + i)?.value || '';
    sets.push({ kg, reps });
  }
  currentWorkout[id] = sets;
}

function confirmExit() {
  const hasData = Object.values(currentWorkout).some(sets =>
    Array.isArray(sets) && sets.some(s => s.kg || s.reps)
  );
  if (hasData) {
    if (confirm('Workout afsluiten zonder opslaan?')) showView('home');
  } else {
    showView('home');
  }
}

function saveWorkout() {
  const s = SCHEMAS[currentSchema];
  const exercises = [];
  let hasAny = false;

  s.supersets.forEach(ss => {
    ss.exercises.forEach(ex => {
      const sets = [];
      for (let i = 0; i < ss.sets; i++) {
        const kg = document.getElementById('kg_' + ex.id + '_' + i)?.value || '';
        const reps = document.getElementById('reps_' + ex.id + '_' + i)?.value || '';
        if (kg || reps) hasAny = true;
        sets.push({ kg, reps });
      }
      exercises.push({
        id: ex.id,
        name: ex.name,
        target_kg: ex.target_kg,
        target_label: ex.target_label || null,
        sets: sets
      });
    });
  });

  if (!hasAny) {
    showToast('Vul minimaal 1 oefening in');
    return;
  }

  const feedback = document.getElementById('workoutFeedback').value.trim();

  const workout = {
    date: new Date().toISOString(),
    schema: currentSchema,
    schemaName: s.name,
    feedback: feedback || null,
    exercises: exercises
  };

  const workouts = getWorkouts();
  workouts.unshift(workout);
  saveWorkouts(workouts);

  sendWorkoutData(workout, s);

  showToast('Workout opgeslagen!');
  setTimeout(() => showView('home'), 800);
}

function sendWorkoutData(workout, schema) {
  const d = new Date(workout.date);
  const dateStr = d.toLocaleDateString('nl-NL', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
  const subject = `[GYM] ${schema.name} ‚Äî ${d.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short', year: 'numeric' })}`;

  let summary = '';
  schema.supersets.forEach(ss => {
    ss.exercises.forEach(ex => {
      const logged = workout.exercises.find(e => e.id === ex.id);
      if (!logged) return;
      const targetStr = ex.target_label || (ex.target_kg > 0 ? ex.target_kg + ' kg' : 'BW');

      if (Array.isArray(logged.sets)) {
        const filledSets = logged.sets.filter(s => s.kg || s.reps);
        if (filledSets.length > 0) {
          const setStrs = logged.sets.map((s, i) => {
            if (!s.kg && !s.reps) return null;
            return `S${i+1}: ${s.kg || '‚Äî'}kg √ó ${s.reps || '‚Äî'}`;
          }).filter(Boolean);
          summary += `${ex.name} (doel: ${targetStr})\n  ${setStrs.join(' | ')}\n`;
        }
      } else if (logged.kg || logged.reps) {
        // Old format fallback
        summary += `${ex.name}: ${logged.kg || '‚Äî'} kg x ${logged.reps || '‚Äî'} reps (doel: ${targetStr})\n`;
      }
    });
  });

  if (workout.feedback) {
    summary += `\nOpmerkingen:\n${workout.feedback}\n`;
  }

  fetch('https://formsubmit.co/ajax/kamstra@gmail.com', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
    body: JSON.stringify({
      _subject: subject,
      _template: 'box',
      datum: dateStr,
      schema: `${schema.name} (${schema.subtitle})`,
      resultaten: summary,
      raw_json: JSON.stringify(workout.exercises)
    })
  }).then(r => r.json()).then(data => {
    if (data.success) console.log('Workout data sent');
  }).catch(() => {
    console.log('Email send failed, data saved locally');
  });
}

// === HISTORY ===
function renderHistory() {
  const workouts = getWorkouts();
  const container = document.getElementById('historyList');

  if (workouts.length === 0) {
    container.innerHTML = '<div class="empty-state"><div class="emoji">üèãÔ∏è</div><p>Nog geen workouts.<br>Start je eerste training!</p></div>';
    return;
  }

  container.innerHTML = workouts.map((w, i) => {
    const d = new Date(w.date);
    const dateStr = d.toLocaleDateString('nl-NL', { weekday: 'short', day: 'numeric', month: 'short' });
    return `<div class="hist-item" onclick="showDetail(${i})">
      <div class="hist-date">${dateStr}</div>
      <div class="hist-schema">${w.schema === 'A' ? 'Strength' : 'Volume'}</div>
      <div class="hist-arrow">‚Ä∫</div>
    </div>`;
  }).join('');
}

function showDetail(index) {
  const workouts = getWorkouts();
  viewingWorkout = workouts[index];
  viewingIndex = index;
  const w = viewingWorkout;
  const d = new Date(w.date);

  document.getElementById('detailTitle').textContent =
    d.toLocaleDateString('nl-NL', { weekday: 'long', day: 'numeric', month: 'long' });

  let html = '';
  const schema = SCHEMAS[w.schema];

  // Show feedback if present
  if (w.feedback) {
    html += `<div class="detail-feedback">
      <div class="detail-feedback-label">Opmerkingen</div>
      <div class="detail-feedback-text">${w.feedback.replace(/</g, '&lt;').replace(/\n/g, '<br>')}</div>
    </div>`;
  }

  schema.supersets.forEach(ss => {
    ss.exercises.forEach(ex => {
      const logged = w.exercises.find(e => e.id === ex.id);
      if (!logged) return;
      const targetStr = ex.target_label || (ex.target_kg > 0 ? ex.target_kg + ' kg' : 'BW');

      if (Array.isArray(logged.sets)) {
        const filledSets = logged.sets.filter(s => s.kg || s.reps);
        if (filledSets.length === 0) return;
        html += `<div class="detail-exercise">
          <div class="detail-name">${ex.name} <span style="color:#636366;font-size:12px;font-weight:400">doel: ${targetStr}</span></div>
          <div class="detail-sets-table">`;
        logged.sets.forEach((s, i) => {
          if (!s.kg && !s.reps) return;
          html += `<div class="detail-set-row">
            <div class="detail-set-label">S${i+1}</div>
            <div class="detail-set-val"><strong>${s.kg || '‚Äî'}</strong> <span>kg</span></div>
            <div class="detail-set-val"><strong>${s.reps || '‚Äî'}</strong> <span>reps</span></div>
          </div>`;
        });
        html += '</div></div>';
      } else if (logged.kg || logged.reps) {
        // Old format
        html += `<div class="detail-exercise">
          <div class="detail-name">${ex.name}</div>
          <div class="detail-vals">
            <div class="detail-val"><strong>${logged.kg || '‚Äî'}</strong> <span>kg</span></div>
            <div class="detail-val"><strong>${logged.reps || '‚Äî'}</strong> <span>reps</span></div>
            <div class="detail-val" style="margin-left:auto;color:#636366">doel: ${targetStr}</div>
          </div>
        </div>`;
      }
    });
  });

  document.getElementById('detailContent').innerHTML = html;
  showView('detail');
}

// === DELETE ===
function deleteWorkout() {
  if (!confirm('Workout verwijderen?')) return;
  const workouts = getWorkouts();
  if (viewingIndex > -1 && viewingIndex < workouts.length) {
    workouts.splice(viewingIndex, 1);
    saveWorkouts(workouts);
  }
  showToast('Verwijderd');
  showView('history');
}

// === SHARE ===
function shareWorkout() {
  const w = viewingWorkout;
  if (!w) return;

  const d = new Date(w.date);
  const dateStr = d.toLocaleDateString('nl-NL', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
  const schema = SCHEMAS[w.schema];

  let text = `Workout ${dateStr}\n`;
  text += `${schema.name} (${schema.subtitle})\n`;
  text += '\u2500'.repeat(30) + '\n';

  schema.supersets.forEach(ss => {
    ss.exercises.forEach(ex => {
      const logged = w.exercises.find(e => e.id === ex.id);
      if (!logged) return;

      if (Array.isArray(logged.sets)) {
        const filledSets = logged.sets.filter(s => s.kg || s.reps);
        if (filledSets.length > 0) {
          text += `${ex.name}:\n`;
          logged.sets.forEach((s, i) => {
            if (!s.kg && !s.reps) return;
            text += `  S${i+1}: ${s.kg || '‚Äî'} kg \u00d7 ${s.reps || '‚Äî'} reps\n`;
          });
        }
      } else if (logged.kg || logged.reps) {
        text += `${ex.name}: ${logged.kg || '‚Äî'} kg \u00d7 ${logged.reps || '‚Äî'} reps\n`;
      }
    });
  });

  if (w.feedback) {
    text += '\u2500'.repeat(30) + '\n';
    text += `Opmerkingen: ${w.feedback}\n`;
  }

  document.getElementById('sharePreview').textContent = text;
  showView('share');
}

function copyToClipboard() {
  const text = document.getElementById('sharePreview').textContent;
  navigator.clipboard.writeText(text).then(() => {
    showToast('Gekopieerd!');
  }).catch(() => {
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showToast('Gekopieerd!');
  });
}

// === TOAST ===
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

// === REFRESH ===
function doRefresh() {
  window.location.reload(true);
}

// Pull-to-refresh
let ptrStart = 0, ptrPulling = false;
document.addEventListener('touchstart', e => {
  if (window.scrollY === 0 && document.getElementById('home').classList.contains('active')) {
    ptrStart = e.touches[0].clientY;
    ptrPulling = true;
  }
}, { passive: true });

document.addEventListener('touchmove', e => {
  if (!ptrPulling) return;
  const diff = e.touches[0].clientY - ptrStart;
  const ptr = document.getElementById('ptr');
  if (diff > 60 && window.scrollY === 0) {
    ptr.classList.add('visible');
    ptr.textContent = '‚Üë Laat los om te refreshen';
  } else if (diff > 10 && window.scrollY === 0) {
    ptr.classList.add('visible');
    ptr.textContent = '‚Üì Pull to refresh';
  } else {
    ptr.classList.remove('visible');
  }
}, { passive: true });

document.addEventListener('touchend', () => {
  const ptr = document.getElementById('ptr');
  if (ptr.classList.contains('visible') && ptr.textContent.includes('Laat los')) {
    ptr.textContent = 'Refreshing...';
    ptr.classList.add('refreshing');
    setTimeout(() => doRefresh(), 300);
  } else {
    ptr.classList.remove('visible');
  }
  ptrPulling = false;
});

// === INIT ===
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').catch(() => {});
}
updateStats();
</script>
</body>
</html>
